= Import photos meta data answers
:csv-url: https://raw.githubusercontent.com/neo4j-meetups/modeling-worked-example/master/data/
:icons: font

== Exercise: Import photos meta data

* Import the photo meta data into the graph.

We probably want to create this pattern `(member)-[:POSTED]->(photo)-[:EVENT]->(event)` although you are of course free to create whatever you like!

== Import photos meta data

[source,cypher, subs=attributes]
----
CALL apoc.load.json("https://api.meetup.com/graphdb-london/photos?&sign=true&photo-host=public")
YIELD value AS document
WITH document WHERE EXISTS(document.photo_album.event.id)

MATCH (event:Event {id: document.photo_album.event.id})
OPTIONAL MATCH (member:Member {id: tostring(document.member.id)})

MERGE (photo:Photo {id: document.id})
ON CREATE SET photo.link = document.link, photo.created = document.created

MERGE (member)-[:POSTED_PHOTO]->(photo)
MERGE (photo)-[:POSTED_IN_EVENT]->(event)

RETURN document.link AS link,
       document.created AS time,
       document.id AS photoId,
       document.member.id as memberId,
       document.photo_album.event.id AS eventId
----
