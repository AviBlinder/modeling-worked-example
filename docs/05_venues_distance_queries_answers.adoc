= Venue Distance Queries Answers
:csv-url: https://raw.githubusercontent.com/neo4j-meetups/modeling-worked-example/master/data/
:icons: font

== Exercise: Using venues in recommendations

* Update the events recommendation query we wrote earlier to return the distance to here
* Filter out events which are more than 1km away

== Return distance to venue

[source,cypher,subs=attributes]
----
WITH {latitude: 51.518551, longitude: -0.086114} AS here

MATCH (member:Member {name: "Mark Needham"})-[:MEMBER_OF]->()-[:HOSTED_EVENT]->(futureEvent),
      (venue)<-[:VENUE]-(futureEvent)
WHERE futureEvent.time > timestamp()

RETURN group.name,
       futureEvent.name,
       round((futureEvent.time - timestamp()) / (24.0*60*60*1000)) AS days,
       distance(venue, here) AS distance
ORDER BY days
----

== Filter out events > 1km away

[source,cypher,subs=attributes]
----
WITH {latitude: 51.518551, longitude: -0.086114} AS here

MATCH (member:Member {name: "Mark Needham"})-[:MEMBER_OF]->()-[:HOSTED_EVENT]->(futureEvent),
      (venue)<-[:VENUE]-(futureEvent)

WITH group, futureEvent, distance(venue, here) AS distance
WHERE distance < 1000

RETURN group.name,
       futureEvent.name,
       round((futureEvent.time - timestamp()) / (24.0*60*60*1000)) AS days,
       distance
ORDER BY days
----
